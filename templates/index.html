<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Focaloid GenAI-Powered Quality Engineering Tools</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <style>
        body {
            background-image: url("{{ url_for('static', filename='background.jpg') }}");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .bg-overlay {
            background: rgba(10, 20, 40, 0.7); /* dark overlay for readability */
        }
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="bg-overlay min-h-screen">
        <div class="container mx-auto px-4 py-8">
            <header class="flex items-center mb-12">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Focaloid Logo" class="h-16 w-auto mr-6">
                <div class="flex-1 flex flex-col items-center">
                    <h1 class="text-4xl font-bold text-white mb-2 text-center">Focaloid GenAI-Powered Quality Engineering Tools</h1>
                    <p class="text-white font-bold text-center">GenAI for Smart QA: Test Design, Automation, and Triage using Cursor AI</p>
                </div>
            </header>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <form method="POST" enctype="multipart/form-data" class="space-y-6">
                    {{ form.csrf_token }}
                    
                    <div class="mb-6">
                        <label for="jira_id" class="block text-sm font-medium text-gray-700 mb-2">Jira Ticket ID</label>
                        <input type="text" 
                               name="jira_id" 
                               id="jira_id" 
                               class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                               placeholder="e.g., MBA-4"
                               style="min-height: 48px;">
                        <p class="mt-1 text-sm text-gray-500">Enter your Jira ticket ID (e.g., MBA-4, PROJ-123)</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="user_story">
                            User Story
                        </label>
                        {{ form.user_story(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", rows=5) }}
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="file">
                            Upload Document/CSV
                        </label>
                        {{ form.file(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        <p class="text-sm text-gray-500 mt-1">Supported formats: .docx, .csv, .xlsx</p>
                    </div>

                    <div class="text-right">
                        {{ form.submit(class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-200") }}
                    </div>
                </form>
            </div>

            <!-- Automation Script Generator Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">ðŸ¤– Natural Language to Automation Script</h2>
                <p class="text-gray-600 mb-6">Convert plain English test scenarios into working Selenium or Playwright automation scripts.</p>
                
                <form method="POST" enctype="multipart/form-data" class="space-y-6">
                    {{ form.csrf_token }}
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="automation_scenario">
                            Automation Scenario (Natural Language)
                        </label>
                        {{ form.automation_scenario(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", rows=4, placeholder="e.g., Login with valid credentials and check dashboard, or Navigate to the product page, add item to cart, and verify checkout process") }}
                        <p class="text-sm text-gray-500 mt-1">Describe your test scenario in plain English</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="automation_framework">
                            Automation Framework
                        </label>
                        {{ form.automation_framework(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        <p class="text-sm text-gray-500 mt-1">Choose your preferred automation framework and language</p>
                    </div>

                    <div class="text-right">
                        {{ form.generate_automation(class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition duration-200") }}
                    </div>
                </form>
            </div>

            <!-- Log Analysis Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">ðŸ§  Test Log Analysis & Bug Triage</h2>
                <form method="POST" enctype="multipart/form-data" class="space-y-6">
                    {{ form.csrf_token }}
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="log_text">
                            Paste CI/CD Log or Test Report
                        </label>
                        {{ form.log_text(class="w-full px-3 py-2 border rounded-lg", rows=6) }}
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="log_file">
                            Or Upload Log File
                        </label>
                        {{ form.log_file(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="send_slack_notification">
                                Send to Slack
                            </label>
                            {{ form.send_slack_notification(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="send_teams_notification">
                                Send to Teams
                            </label>
                            {{ form.send_teams_notification(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                    </div>

                    <div class="text-right">
                        {{ form.analyze_log(class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition duration-200") }}
                    </div>
                </form>
            </div>

            {% if log_analysis %}
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">AI Log Analysis</h2>
                <pre class="bg-gray-100 p-4 rounded-lg whitespace-pre-wrap">{{ log_analysis }}</pre>
            </div>
            {% endif %}

            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4" role="alert">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Automation Script Results -->
            {% if automation_script %}
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Generated Automation Script</h2>
                
                <div class="mb-4">
                    <h3 class="text-lg font-medium text-gray-700 mb-2">Script Preview</h3>
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto">
                        <pre><code>{{ automation_script }}</code></pre>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-4">
                    {% if automation_file_path %}
                    <a href="{{ url_for('download_file', filename=automation_file_path) }}" 
                       class="inline-flex items-center justify-center bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition duration-200 min-w-[120px]">
                        Download Script
                    </a>
                    {% endif %}
                    
                    <button onclick="copyToClipboard()" 
                            class="inline-flex items-center justify-center bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-200 min-w-[120px]">
                        Copy Code
                    </button>
                </div>
            </div>
            {% endif %}

            {% if jira_ticket %}
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Jira Ticket Details</h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="text-lg font-medium text-gray-700">Summary</h3>
                        <p class="text-gray-600">{{ jira_ticket.summary }}</p>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-gray-700">Description</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            {{ jira_ticket.description | nl2br | safe }}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if test_cases_df is defined and not test_cases_df.empty %}
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Generated Test Cases</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                {% for column in test_cases_df.columns %}
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    {{ column }}
                                </th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for _, row in test_cases_df.iterrows() %}
                            <tr>
                                {% for column in test_cases_df.columns %}
                                <td class="px-6 py-4 whitespace-pre-wrap text-sm text-gray-500">
                                    {{ row[column] | nl2br | safe }}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6 flex justify-end space-x-4">
                    {% if pdf_path %}
                    <a href="{{ url_for('download_file', filename=pdf_path) }}" 
                       class="inline-flex items-center justify-center bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition duration-200 min-w-[120px]">
                        Download PDF
                    </a>
                    {% endif %}
                    
                    {% if excel_path %}
                    <a href="{{ url_for('download_file', filename=excel_path) }}" 
                       class="inline-flex items-center justify-center bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition duration-200 min-w-[120px]">
                        Download Excel
                    </a>
                    {% endif %}
                    
                    {% if jira_ticket %}
                    <button onclick="addToQMetry(event)" 
                            class="inline-flex items-center justify-center bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-200 min-w-[120px]"
                            data-test-cases='{{ test_cases_df.to_dict("records")|tojson|safe }}'
                            data-ticket-id="{{ jira_ticket.key }}">
                        Add to QMetry
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% if structured_test_cases %}
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Generated Test Cases</h2>
                {% for case in structured_test_cases %}
                <div class="mb-8">
                    <h3 class="text-lg font-medium text-gray-700 mb-2">User Story</h3>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        {{ case.user_story | nl2br | safe }}
                    </div>
                    
                    <h3 class="text-lg font-medium text-gray-700 mb-2">Test Cases</h3>
                    {% for test_case in case.test_cases %}
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        {{ test_case | nl2br | safe }}
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
                
                <div class="mt-6 flex justify-end space-x-4">
                    {% if pdf_path %}
                    <a href="{{ url_for('download_file', filename=pdf_path) }}" 
                       class="inline-flex items-center justify-center bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition duration-200 min-w-[120px]">
                        Download PDF
                    </a>
                    {% endif %}
                    
                    {% if excel_path %}
                    <a href="{{ url_for('download_file', filename=excel_path) }}" 
                       class="inline-flex items-center justify-center bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition duration-200 min-w-[120px]">
                        Download Excel
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Webhook Testing Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-plug"></i> Webhook Testing
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Test your Teams and Slack webhook configurations</p>
                    <button type="button" class="btn btn-info" onclick="testWebhooks()">
                        <i class="fas fa-vial"></i> Test Webhooks
                    </button>
                    <div id="webhook-results" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 